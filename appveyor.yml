version: '1.0.{build}'
image: Visual Studio 2017
branches:
  only:
    - master
init:
  - cmd: git config --global core.autocrlf true
install:
  - cmd: dotnet --version
  - cmd: cd aliyun-net-sdk-core.Tests/
build_script:
  - cmd: dotnet restore
  - cmd: dotnet build
test_script:
  - dotnet build
  - test -z $ACCESS_KEY_ID -a -z $ACCESS_KEY_SECRET && dotnet test --filter Category!=FeatureTest || dotnet test
on_finish:
  - ps: |
      $env:PATH = 'C:\msys64\usr\bin;' + $env:PATH
      Invoke-WebRequest -Uri 'https://codecov.io/bash' -OutFile codecov.sh
      bash codecov.sh -f "coverage.xml"
